import{r as R,s as Q}from"./props.DlEwSLNC.js";import{i as X}from"./lifecycle.4RJr1wVS.js";import{l as A,h as Y,f as F,i as Z,g as n,j as N,a as O,p as tt,b as et,d as u,c as m,m as M,r as f,s as b,t as rt,u as w}from"./utils.Cg4U3nbu.js";import{s as j}from"./render.DYyMPRCR.js";import{e as at,i as nt}from"./each.B6NhhFus.js";import{I as k,h as st}from"./Icon.lymwO5qu.js";import{b as D}from"./input.CcGWhDUD.js";import{u as ot}from"./url-utils.CHWdgz7q.js";/* empty css                        */var lt=F(`<a class="transition first-of-type:mt-2 lg:first-of-type:mt-0 group block
       rounded-xl text-lg px-3 py-2 hover:bg-[var(--btn-plain-bg-hover)] active:bg-[var(--btn-plain-bg-active)]"><div class="transition text-90 inline-flex font-bold group-hover:text-[var(--primary)]"> <!></div> <div class="transition text-xs mb-1 font-mono text-black/40 dark:text-white/40
                        group-hover:text-black/60 dark:group-hover:text-white/60"> </div> <div class="transition text-sm text-50"><!></div></a>`),it=F(`<div id="search-bar" class="hidden lg:flex transition-all items-center h-11 mr-2 rounded-lg
      bg-black/[0.04] hover:bg-black/[0.06] focus-within:bg-black/[0.06]
      dark:bg-white/5 dark:hover:bg-white/10 dark:focus-within:bg-white/10
"><!> <input placeholder="過去の記事" class="transition-all pl-10 text-sm bg-transparent outline-0
         h-full w-40 active:w-60 focus:w-60 text-black/50 dark:text-white/50 svelte-1wah7ro"/></div> <button aria-label="Search Panel" id="search-switch" class="btn-plain scale-animation lg:!hidden rounded-lg w-11 h-11 active:scale-90"><!></button> <div id="search-panel" class="float-panel float-panel-closed search-panel absolute md:w-[30rem]
top-20 left-4 md:left-[unset] right-4 shadow-2xl rounded-2xl p-2 svelte-1wah7ro"><div id="search-bar-inside" class="flex relative lg:hidden transition-all items-center h-11 rounded-xl
      bg-black/[0.04] hover:bg-black/[0.06] focus-within:bg-black/[0.06]
      dark:bg-white/5 dark:hover:bg-white/10 dark:focus-within:bg-white/10
  "><!> <input placeholder="Search" class="pl-10 absolute inset-0 text-sm bg-transparent outline-0
               focus:w-60 text-black/50 dark:text-white/50 svelte-1wah7ro"/></div> <!></div>`,1);function gt(H,K){et(K,!1);function U(r,e){let t;return(...c)=>{clearTimeout(t),t=setTimeout(()=>r(...c),e)}}let v=M(""),p=M(""),x=M([]),P=[],E=!1;const V=async()=>{if(!E)try{const e=await(await fetch("/rss.xml")).text(),a=new DOMParser().parseFromString(e,"text/xml").querySelectorAll("item");P=Array.from(a).map(d=>{let o="";const s=d.getElementsByTagNameNS("*","encoded")[0]?.textContent||d.querySelector("*|encoded")?.textContent||"";if(s){const i=document.createElement("div");i.innerHTML=s,o=i.textContent||i.innerText||""}const l=d.querySelector("link")?.textContent||"";let h="";if(l.includes("/posts/")){const i=l.match(/\/posts\/(.+?)(?:\/$|$)/);i&&(h=i[1])}else{const i=l.split("/").filter(Boolean);h=i[i.length-1]||""}return{title:d.querySelector("title")?.textContent||"",description:d.querySelector("description")?.textContent||"",content:o,link:h,fullLink:l}}),E=!0}catch(r){console.error("Error fetching RSS:",r)}},W=()=>{document.getElementById("search-panel")?.classList.toggle("float-panel-closed")},y=(r,e)=>{const t=document.getElementById("search-panel");!t||!e||(r?t.classList.remove("float-panel-closed"):t.classList.add("float-panel-closed"))},z=(r,e)=>{if(!e)return r;const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),c=new RegExp(`(${t})`,"gi");return r.replace(c,"<mark>$1</mark>")},_=U(async(r,e)=>{if(!r.trim()){y(!1,e),b(x,[]);return}await V();try{const t=r.toLowerCase().trim(),c=P.filter(a=>{const d=a.title.toLowerCase().includes(t),o=a.description?.toLowerCase().includes(t),s=a.link.toLowerCase().includes(t),l=a.content.toLowerCase().includes(t);return d||o||s||l}).map(a=>{const o=a.content.toLowerCase().indexOf(t);let s="";if(o!==-1){const h=Math.max(0,o-50),i=Math.min(a.content.length,o+100);s=a.content.substring(h,i),h>0&&(s="..."+s),i<a.content.length&&(s=s+"...")}else s=a.description||a.content.substring(0,150)+"...";const l=a.link.startsWith("/")?a.link:`/posts/${a.link}/`;return{url:ot(l),meta:{title:a.title},excerpt:z(s,r),urlPath:l}});b(x,c),y(n(x).length>0,e)}catch(t){console.error("Search error:",t),b(x,[]),y(!1,e)}finally{}},300);A(()=>n(v),()=>{n(v)!==void 0&&_(n(v),!0)}),A(()=>n(p),()=>{n(p)!==void 0&&_(n(p),!1)}),Y(),X();var T=it(),S=Z(T),$=m(S);k($,{icon:"material-symbols:search",class:"absolute text-[1.25rem] pointer-events-none ml-3 transition my-auto text-black/30 dark:text-white/30"});var L=u($,2);R(L),f(S);var g=u(S,2),G=m(g);k(G,{icon:"material-symbols:search",class:"text-[1.25rem]"}),f(g);var q=u(g,2),C=m(q),I=m(C);k(I,{icon:"material-symbols:search",class:"absolute text-[1.25rem] pointer-events-none ml-3 transition my-auto text-black/30 dark:text-white/30"});var B=u(I,2);R(B),f(C);var J=u(C,2);at(J,1,()=>n(x),nt,(r,e)=>{var t=lt(),c=m(t),a=m(c,!0),d=u(a);k(d,{icon:"fa6-solid:chevron-right",class:"transition text-[0.75rem] translate-x-1 my-auto text-[var(--primary)]"}),f(c);var o=u(c,2),s=m(o,!0);f(o);var l=u(o,2),h=m(l);st(h,()=>(n(e),w(()=>n(e).excerpt))),f(l),f(t),rt(()=>{Q(t,"href",(n(e),w(()=>n(e).url))),j(a,(n(e),w(()=>n(e).meta.title))),j(s,(n(e),w(()=>n(e).urlPath)))}),O(r,t)}),f(q),D(L,()=>n(v),r=>b(v,r)),N("focus",L,()=>_(n(v),!0)),N("click",g,W),D(B,()=>n(p),r=>b(p,r)),O(H,T),tt()}export{gt as default};
